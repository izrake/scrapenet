<!DOCTYPE html>
<html>
<head>
    <title>Twitter Scraper</title>
    <style>
        /* Base Styles */
        body {
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 20px;
            background-color: #f0f0f0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Neo Brutalism Base Components */
        .neo-card {
            background: white;
            border: 3px solid black;
            padding: 20px;
            box-shadow: 8px 8px 0 black;
            margin-bottom: 30px;
            position: relative;
        }

        .neo-input {
            background: white;
            border: 3px solid black;
            padding: 12px;
            font-size: 16px;
            box-shadow: 4px 4px 0 black;
            transition: all 0.2s ease;
            width: 100%;
            margin-bottom: 10px;
        }

        .neo-input:focus {
            outline: none;
            box-shadow: 8px 8px 0 black;
            transform: translate(-4px, -4px);
        }

        .neo-button {
            background: white;
            border: 3px solid black;
            padding: 12px 24px;
            font-weight: bold;
            box-shadow: 4px 4px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 5px;
        }

        .neo-button:hover {
            box-shadow: 8px 8px 0 black;
            transform: translate(-4px, -4px);
        }

        .neo-button:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .neo-button.danger {
            background: #ff4444;
            color: white;
        }

        /* Header Styles */
        h1, h2, h3 {
            font-weight: bold;
            margin-bottom: 20px;
            position: relative;
        }

        h1::after, h2::after, h3::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: black;
        }

        /* Status Styles */
        .status {
            padding: 15px;
            margin: 15px 0;
            border: 3px solid black;
        }

        .status.ready {
            background: #a8e6cf;
            box-shadow: 4px 4px 0 #2d3436;
        }

        .status.not-ready {
            background: #ffaaa5;
            box-shadow: 4px 4px 0 #2d3436;
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 30px;
            gap: 10px;
            border-bottom: 3px solid black;
            padding-bottom: 10px;
            background: white;
            padding: 15px;
            border: 3px solid black;
            box-shadow: 6px 6px 0 black;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: 3px solid transparent;
            font-weight: bold;
            transition: all 0.2s ease;
            position: relative;
            background: white;
        }

        .tab:hover {
            transform: translateY(-2px);
        }

        .tab.active {
            border: 3px solid black;
            box-shadow: 4px 4px 0 black;
            background: #e3f2fd;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: #e3f2fd;
        }

        /* Scrape Options */
        .scrape-option {
            background: white;
            border: 3px solid black;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 6px 6px 0 black;
        }

        .scrape-option:hover {
            transform: translate(-2px, -2px);
            box-shadow: 8px 8px 0 black;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        /* Auto-scrape Section */
        .auto-scrape-controls {
            background: white;
            border: 3px solid black;
            padding: 25px;
            box-shadow: 8px 8px 0 black;
            margin-bottom: 30px;
        }

        .scrape-type-selector {
            background: #f0f0f0;
            border: 3px solid black;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 4px 4px 0 black;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .radio-option {
            position: relative;
            padding: 15px;
            background: white;
            border: 3px solid black;
            box-shadow: 4px 4px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 200px;
        }

        .radio-option:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .radio-option.selected {
            background: #e3f2fd;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .profile-controls {
            margin-top: 20px;
            padding: 20px;
            border: 3px solid black;
            background: white;
            box-shadow: 4px 4px 0 black;
        }

        .profile-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .profile-item {
            background: white;
            border: 3px solid black;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 4px 4px 0 black;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .profile-item:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .profile-username {
            font-weight: bold;
            font-size: 1.1em;
        }

        .profile-timestamp {
            font-size: 0.9em;
            color: #666;
        }

        .remove-profile {
            background: #ff4444;
            color: white;
            border: 2px solid black;
            padding: 8px 15px;
            font-weight: bold;
            box-shadow: 3px 3px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .remove-profile:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 black;
        }

        .interval-selector {
            margin: 20px 0;
            padding: 20px;
            border: 3px solid black;
            background: white;
            box-shadow: 4px 4px 0 black;
        }

        .interval-selector select {
            width: 100%;
            padding: 12px;
            border: 3px solid black;
            background: white;
            font-size: 1.1em;
            box-shadow: 4px 4px 0 black;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .interval-selector select:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .auto-scrape-status {
            margin-top: 20px;
            padding: 20px;
            border: 3px solid black;
            background: #e3f2fd;
            box-shadow: 4px 4px 0 black;
        }

        .countdown-display {
            font-size: 1.5em;
            font-weight: bold;
            margin: 10px 0;
            padding: 15px;
            background: white;
            border: 3px solid black;
            box-shadow: 4px 4px 0 black;
            text-align: center;
        }

        /* Query Section */
        .query-section {
            background: white;
            border: 3px solid black;
            padding: 20px;
            box-shadow: 8px 8px 0 black;
            margin-bottom: 20px;
        }

        .results-container {
            border: 3px solid black;
            margin-top: 20px;
        }

        .tweet-result {
            border-bottom: 3px solid black;
            padding: 15px;
            background: white;
        }

        .tweet-result:last-child {
            border-bottom: none;
        }

        .tweet-header {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid black;
        }

        .tweet-metrics {
            margin-top: 10px;
            display: flex;
            gap: 15px;
            font-weight: bold;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Configuration Panel */
        .config-panel {
            background: #f0f0f0;
            border: 3px solid black;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 8px 8px 0 black;
        }

        .parameter-group {
            margin: 15px 0;
            padding: 15px;
            border: 2px solid black;
            background: white;
        }

        /* Range Input Styling */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 3px;
            background: black;
            outline: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid black;
            cursor: pointer;
            box-shadow: 2px 2px 0 black;
        }

        /* History Section */
        .history-item {
            background: white;
            border: 3px solid black;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 4px 4px 0 black;
        }

        .history-item:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        /* Utility Classes */
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-4 { gap: 1rem; }
        .font-bold { font-weight: bold; }
        .text-lg { font-size: 1.125rem; }
        .text-sm { font-size: 0.875rem; }

        /* Tab Content Styles */
        .tab-content {
            display: none;
            background: white;
            border: 3px solid black;
            padding: 20px;
            box-shadow: 8px 8px 0 black;
            margin-bottom: 30px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Enhanced Auth Button */
        .auth-button {
            background: white;
            border: 3px solid black;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            box-shadow: 6px 6px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 20px 0;
            min-width: 300px;
            text-align: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .auth-button:hover {
            transform: translate(-4px, -4px);
            box-shadow: 10px 10px 0 black;
        }

        .auth-button:active {
            transform: translate(2px, 2px);
            box-shadow: 4px 4px 0 black;
        }

        .auth-button.loading {
            background: #e0e0e0;
            cursor: wait;
        }

        .auth-button.danger {
            background: #ff4444;
            color: white;
        }

        /* Scraping Status Indicator */
        .scraping-status {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 30px;
            background: white;
            border: 3px solid black;
            box-shadow: 4px 4px 0 black;
            z-index: 1000;
            font-weight: bold;
            font-size: 1.1em;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .scraping-status.active {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .scraping-status.in-progress {
            background: #ffd700;
        }

        .scraping-status.completed {
            background: #a8e6cf;
        }

        .scraping-status .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid black;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideDown {
            from {
                transform: translate(-50%, -100%);
            }
            to {
                transform: translate(-50%, 0);
            }
        }

        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Neo Brutalism Scraping Sections */
        .neo-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid black;
            position: relative;
        }

        .neo-description {
            font-size: 1.1em;
            margin-bottom: 20px;
            padding: 10px;
            background: #f0f0f0;
            border: 2px solid black;
            box-shadow: 3px 3px 0 black;
        }

        .neo-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 1.1em;
            color: black;
            background: #ffd700;
            padding: 5px 10px;
            border: 2px solid black;
            box-shadow: 2px 2px 0 black;
            width: fit-content;
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border: 3px solid black;
            box-shadow: 6px 6px 0 black;
        }

        .scrape-option {
            background: white;
            border: 3px solid black;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 8px 8px 0 black;
            transition: all 0.2s ease;
        }

        .scrape-option:hover {
            transform: translate(-4px, -4px);
            box-shadow: 12px 12px 0 black;
        }

        .neo-input {
            width: 100%;
            padding: 12px 15px;
            font-size: 1.1em;
            border: 3px solid black;
            background: white;
            box-shadow: 4px 4px 0 black;
            transition: all 0.2s ease;
            margin-bottom: 15px;
        }

        .neo-input:focus {
            outline: none;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .neo-input:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
        }

        .neo-button {
            width: 100%;
            padding: 15px 25px;
            font-size: 1.2em;
            font-weight: bold;
            border: 3px solid black;
            background: white;
            box-shadow: 5px 5px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .neo-button:hover:not(:disabled) {
            transform: translate(-2px, -2px);
            box-shadow: 7px 7px 0 black;
        }

        .neo-button:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: 3px 3px 0 black;
        }

        .neo-button:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .neo-results {
            margin-top: 30px;
            padding: 20px;
            border: 3px solid black;
            background: white;
            box-shadow: 6px 6px 0 black;
        }

        .neo-results pre {
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            padding: 15px;
            background: #f5f5f5;
            border: 2px solid black;
            overflow-x: auto;
        }

        /* Error Message Styling */
        .neo-error {
            padding: 15px;
            background: #ff4444;
            color: white;
            border: 3px solid black;
            box-shadow: 4px 4px 0 black;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .input-group {
                grid-template-columns: repeat(2, 1fr);
            }

            .neo-button {
                grid-column: span 2;
            }

            .radio-group {
                flex-direction: row;
            }

            .profile-input-group {
                grid-template-columns: 1fr auto;
            }
        }

        /* Additional Neo Brutalism Styles */
        .neo-subtitle {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 3px solid black;
        }

        .scraping-type {
            font-weight: bold;
            background: #ffd700;
            padding: 3px 8px;
            border: 2px solid black;
            box-shadow: 2px 2px 0 black;
        }

        .scraping-info {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border: 2px solid black;
            box-shadow: 3px 3px 0 black;
        }

        .countdown-timer {
            font-size: 2em;
            font-weight: bold;
            color: #2196f3;
            margin-top: 10px;
        }

        .auto-scrape-actions {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .neo-button.danger {
            background: #ff4444;
            color: white;
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 4px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slide-in 0.3s ease-out;
        }

        .notification.success {
            border-left: 4px solid #4CAF50;
        }

        .notification.error {
            border-left: 4px solid #f44336;
        }

        .notification i {
            font-size: 20px;
        }

        .notification.success i {
            color: #4CAF50;
        }

        .notification.error i {
            color: #f44336;
        }

        .notification.fade-out {
            animation: slide-out 0.3s ease-in forwards;
        }

        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slide-out {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Add these styles in the <style> section */
        .history-section {
            background: white;
            border: 3px solid black;
            padding: 25px;
            box-shadow: 8px 8px 0 black;
            margin-bottom: 30px;
        }

        .scraping-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid black;
        }

        .scraping-history-header h2 {
            font-size: 1.8em;
            font-weight: bold;
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .download-all-btn, .clear-history-btn {
            background: white;
            border: 3px solid black;
            padding: 12px 20px;
            font-weight: bold;
            box-shadow: 4px 4px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .download-all-btn:hover, .clear-history-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .download-all-btn:active, .clear-history-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 black;
        }

        .clear-history-btn {
            background: #ff4444;
            color: white;
        }

        .date-section {
            margin-bottom: 30px;
        }

        .date-header {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            padding: 10px;
            background: #f0f0f0;
            border: 3px solid black;
            box-shadow: 4px 4px 0 black;
        }

        .session-card {
            background: white;
            border: 3px solid black;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 4px 4px 0 black;
            transition: all 0.2s ease;
        }

        .session-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .session-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .session-type {
            background: #ffd700;
            padding: 5px 10px;
            border: 2px solid black;
            font-weight: bold;
        }

        .session-target {
            font-weight: bold;
            font-size: 1.1em;
        }

        .session-status {
            padding: 5px 10px;
            border: 2px solid black;
            font-weight: bold;
        }

        .session-status.completed {
            background: #4CAF50;
            color: white;
        }

        .session-status.in_progress {
            background: #2196F3;
            color: white;
        }

        .session-status.failed {
            background: #f44336;
            color: white;
        }

        .session-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .download-btn {
            background: white;
            border: 2px solid black;
            padding: 8px 15px;
            font-weight: bold;
            box-shadow: 3px 3px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 black;
        }

        .download-btn:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Add these styles in the <style> section */
        .chat-section {
            background: white;
            border: 3px solid black;
            padding: 25px;
            box-shadow: 8px 8px 0 black;
            margin-bottom: 30px;
        }

        .config-toggle {
            background: #f0f0f0;
            border: 3px solid black;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 4px 4px 0 black;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }

        .config-toggle:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .config-toggle h3 {
            margin: 0;
            font-size: 1.3em;
        }

        .config-toggle i {
            font-size: 1.2em;
            transition: transform 0.2s ease;
        }

        .config-toggle.collapsed i {
            transform: rotate(-90deg);
        }

        .config-panel {
            background: white;
            border: 3px solid black;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 4px 4px 0 black;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .config-panel.collapsed {
            max-height: 0;
            padding: 0;
            margin: 0;
            border: none;
        }

        .chat-container {
            background: white;
            border: 3px solid black;
            box-shadow: 6px 6px 0 black;
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f8f8f8;
        }

        .message {
            margin-bottom: 20px;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        .user-message {
            margin-left: auto;
            background: #e3f2fd;
            border: 3px solid black;
            padding: 15px;
            box-shadow: 4px 4px 0 black;
            border-radius: 15px 15px 0 15px;
        }

        .bot-message {
            margin-right: auto;
            background: white;
            border: 3px solid black;
            padding: 15px;
            box-shadow: 4px 4px 0 black;
            border-radius: 15px 15px 15px 0;
        }

        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 3px solid black;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            border: 3px solid black;
            font-size: 1.1em;
            box-shadow: 4px 4px 0 black;
            resize: none;
            min-height: 60px;
            max-height: 120px;
            transition: all 0.2s ease;
        }

        .chat-input:focus {
            outline: none;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .send-button {
            background: #4CAF50;
            color: white;
            border: 3px solid black;
            padding: 15px 25px;
            font-weight: bold;
            box-shadow: 4px 4px 0 black;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .send-button:hover:not(:disabled) {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .send-button:disabled {
            background: #e0e0e0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Enhanced LLM Response Styling */
        .insights-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .insight-point {
            background: white;
            border: 3px solid black;
            padding: 20px;
            box-shadow: 4px 4px 0 black;
            transition: all 0.2s ease;
        }

        .insight-point:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .insight-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid black;
            color: #2196F3;
        }

        .insight-content {
            line-height: 1.6;
        }

        .highlight {
            background: #ffd700;
            padding: 2px 5px;
            border: 2px solid black;
            font-weight: bold;
        }

        .highlight-account {
            color: #2196F3;
            font-weight: bold;
        }

        .accounts-list {
            display: grid;
            gap: 15px;
            margin-top: 15px;
        }

        .account-item {
            background: #f8f8f8;
            border: 2px solid black;
            padding: 15px;
            box-shadow: 3px 3px 0 black;
        }

        .account-handle {
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 5px;
        }

        .account-description {
            color: #666;
        }

        /* Add these styles in the <style> section */
        .progress-steps {
            background: white;
            border: 3px solid black;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 4px 4px 0 black;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid black;
            background: #f8f8f8;
            transition: all 0.3s ease;
        }

        .step:last-child {
            margin-bottom: 0;
        }

        .step.active {
            background: #e3f2fd;
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 black;
        }

        .step.completed {
            background: #a8e6cf;
            border-color: #4CAF50;
        }

        .step-icon {
            width: 24px;
            height: 24px;
            border: 3px solid black;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            background: white;
        }

        .step.active .step-icon {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .step.completed .step-icon {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .step-details {
            font-size: 0.9em;
            color: #666;
        }

        .step-timing {
            font-size: 0.8em;
            color: #666;
            font-weight: bold;
        }

        .processing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }

        .processing-indicator .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid black;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Add these styles in the <style> section */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .step-loader {
            display: none;
            margin-left: auto;
            padding-right: 10px;
        }

        .step.active .step-loader {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .loader-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #2196F3;
            border-top: 3px solid transparent;
            border-radius: 50%;
            animation: rotate 1s linear infinite;
        }

        .loader-pulse {
            width: 8px;
            height: 8px;
            background: #2196F3;
            border-radius: 50%;
            margin: 0 2px;
            animation: pulse 1s ease-in-out infinite;
            animation-delay: calc(var(--delay) * 200ms);
        }

        .step.completed .step-loader {
            display: flex;
            align-items: center;
        }

        .completion-check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        /* Add these styles to your existing styles section */
        .step.failed {
            background: #ffebee;
            border-color: #ff4444;
        }

        .step.failed .step-icon {
            background: #ff4444;
            color: white;
            border-color: #ff4444;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-left: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #4CAF50;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        /* Add these styles in the <style> section */
        .data-sharing-toggle {
            background: white;
            border: 3px solid black;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 6px 6px 0 black;
            text-align: center;
        }

        .data-sharing-toggle .toggle-label {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .data-sharing-toggle .help-text {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }

        .btn-danger {
            background-color: #ff6b6b;
            color: white;
            border: 2px solid #000;
            padding: 8px 16px;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
            box-shadow: 4px 4px 0px #000;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-danger:hover {
            background-color: #ff5252;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px #000;
        }

        .btn-danger:active {
            transform: translate(4px, 4px);
            box-shadow: 0px 0px 0px #000;
        }

        .btn-danger:disabled {
            background-color: #ff6b6b;
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
            box-shadow: 4px 4px 0px #000;
        }

        .btn-danger .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 0;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Add these styles to your existing styles */
        .neo-select {
            width: 100%;
            padding: 12px 15px;
            font-size: 1.1em;
            border: 3px solid black;
            background: white;
            box-shadow: 4px 4px 0 black;
            transition: all 0.2s ease;
            margin-bottom: 15px;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }

        .neo-select:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .neo-select:focus {
            outline: none;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .neo-value {
            display: inline-block;
            padding: 4px 8px;
            background: #ffd700;
            border: 2px solid black;
            font-weight: bold;
            margin-left: 10px;
        }

        .parameter-group {
            background: white;
            border: 3px solid black;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 4px 4px 0 black;
            transition: all 0.2s ease;
        }

        .parameter-group:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 black;
        }

        .neo-range {
            -webkit-appearance: none;
            width: 100%;
            height: 3px;
            background: black;
            outline: none;
            margin: 15px 0;
        }

        .neo-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: white;
            border: 3px solid black;
            cursor: pointer;
            box-shadow: 2px 2px 0 black;
            transition: all 0.2s ease;
        }

        .neo-range::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 3px 3px 0 black;
        }

        .header {
            padding: 1rem;
        }

        .header h1 {
            font-weight: 800;
            font-size: 1.5rem;
        }

        /* Error notification styles */
        .error-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #fff;
            border-left: 4px solid #f44336;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 16px;
            width: 320px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .error-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            color: #f44336;
        }

        .error-message {
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .close-error {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            font-size: 18px;
            color: #aaa;
            cursor: pointer;
        }

        .close-error:hover {
            color: #333;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* License notification styles */
        .license-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            width: 500px;
            max-width: 90%;
        }
        
        .license-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1a91da;
        }
        
        .license-content {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .license-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .accept-license {
            background-color: #1a91da;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            float: right;
        }
        
        .accept-license:hover {
            background-color: #0f84c7;
        }

        /* API Delegation Styles */
        .status-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid black;
            box-shadow: 4px 4px 0 black;
        }
        
        .status-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #dc3545;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .status-indicator.enabled {
            background-color: #28a745;
        }
        
        .status-text {
            flex-grow: 1;
        }
        
        .status-text p {
            margin: 0 0 5px 0;
            font-weight: bold;
        }
        
        .info-box {
            margin-top: 20px;
            padding: 15px;
            background: #e3f2fd;
            border: 2px solid black;
            box-shadow: 4px 4px 0 black;
        }
        
        .info-box pre {
            background: white;
            padding: 10px;
            border: 2px solid black;
            overflow-x: auto;
        }
        
        #apiDocsLink {
            color: #0d6efd;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="scrapingStatus" class="scraping-status">
        <div class="spinner"></div>
        <span id="scrapingStatusText">Scraping in Progress...</span>
    </div>

    <div class="container">
        <div class="auth-container">
            <div id="status" class="status"></div>
            <div class="flex items-center justify-center gap-4">
                <button id="auth-button" class="auth-button">
                    <span>Start Twitter Authentication</span>
                </button>
                <button id="logout-button" class="auth-button danger" style="display: none;">
                    <span>Logout from Twitter</span>
                </button>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="scrape">Scrape</div>
            <div class="tab" data-tab="history">Scraping History</div>
            <div class="tab" data-tab="auto-scrape">Auto Scraping</div>
            <div class="tab" data-tab="chat">Chat Analysis</div>
            <div class="tab" data-tab="settings">Settings</div>
            <!-- <div class="tab" data-tab="query">Natural Query</div> -->
        </div>

        <div id="scrapeSection" class="tab-content active">
            <!-- Search Tweets Option -->
            <div class="scrape-option">
                <h3 class="neo-title">Search Tweets</h3>
                <p class="neo-description">Search for tweets using keywords or phrases</p>
                <div class="input-group">
                    <label class="neo-label">Search Query</label>
                    <input type="text" id="query" placeholder="Enter search query" class="neo-input">
                    <label class="neo-label">Number of Tweets</label>
                    <input type="number" id="limit" placeholder="Limit" value="10" class="neo-input" min="1" max="100">
                    <button id="scrape-button" class="neo-button" disabled>
                        <span>Search Tweets</span>
                    </button>
                </div>
            </div>

            <!-- Profile Scraping Option -->
            <div class="scrape-option">
                <h3 class="neo-title">Scrape Profile</h3>
                <p class="neo-description">Get tweets and information from a specific user profile</p>
                <div class="input-group">
                    <label class="neo-label">Twitter Username</label>
                    <input type="text" id="username" placeholder="Enter Twitter username (without @)" class="neo-input">
                    <label class="neo-label">Number of Tweets</label>
                    <input type="number" id="profileLimit" placeholder="Tweet Limit" value="10" class="neo-input" min="1" max="100">
                    <button id="scrape-profile-button" class="neo-button" disabled>
                        <span>Scrape Profile</span>
                    </button>
                </div>
            </div>

            <!-- Home Timeline Option -->
            <div class="scrape-option">
                <h3 class="neo-title">Home Timeline</h3>
                <p class="neo-description">Scrape tweets from your home timeline</p>
                <div class="input-group">
                    <label class="neo-label">Number of Tweets</label>
                    <input type="number" id="homeLimit" placeholder="Tweet Limit" value="10" class="neo-input" min="1" max="100">
                    <button id="scrape-home-button" class="neo-button" disabled>
                        <span>Scrape Home</span>
                    </button>
                </div>
            </div>

            <div id="results" class="neo-results"></div>
        </div>

        <div id="historySection" class="history-section tab-content">
            <div class="scraping-history-header">
                <h2>Scraping History</h2>
                <div class="header-actions">
                    <button id="downloadAllBtn" class="download-all-btn">
                        <i class="fas fa-download"></i> Download All
                    </button>
                    <button id="clearHistoryButton" class="clear-history-btn">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                </div>
            </div>
            <div id="historyResults"></div>
        </div>

        <div id="autoScrapeSection" class="tab-content">
            <h3 class="neo-title">Auto Scraping Settings</h3>
            <div class="auto-scrape-controls">
                <div class="scrape-type-selector">
                    <h4 class="neo-subtitle">Select Scraping Type</h4>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="scrapeType" value="home" checked>
                            <span class="radio-label">Home Timeline</span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="scrapeType" value="profile">
                            <span class="radio-label">Profile Scraping</span>
                        </label>
                    </div>
                </div>

                <div id="profileInputSection" class="profile-controls" style="display: none;">
                    <h4 class="neo-subtitle">Manage Profiles</h4>
                    <div class="profile-input-group">
                        <input type="text" id="profileTarget" placeholder="Enter username to add" class="neo-input">
                        <button id="addProfileButton" class="neo-button">Add Profile</button>
                    </div>
                    <p class="neo-description">You can add up to 5 profiles for auto-scraping</p>
                    <div id="profilesList"></div>
                </div>

                <div class="interval-selector">
                    <h4 class="neo-subtitle">Scraping Interval</h4>
                    <select id="scrapeInterval" class="neo-select">
                        <option value="300000">5 minutes</option>
                        <option value="900000">15 minutes</option>
                        <option value="1800000">30 minutes</option>
                        <option value="3600000" selected>1 hour</option>
                        <option value="7200000">2 hours</option>
                    </select>
                </div>

                <div class="auto-scrape-actions">
                    <button id="auto-scrape-button" class="neo-button">Start Auto Scraping</button>
                    <button id="stop-auto-scrape-button" class="neo-button danger" style="display: none;">Stop Auto Scraping</button>
                </div>

                <div id="nextScrapeInfo" class="auto-scrape-status" style="display: none;">
                    <h4 class="neo-subtitle">Auto-Scraping Status</h4>
                    <div class="countdown-display">
                        <div>Next Auto-Scrape in:</div>
                        <div id="countdownTimer" class="countdown-timer"></div>
                    </div>
                    <div class="scraping-info">
                        Auto-scraping: <span id="scrapingTypeDisplay" class="scraping-type"></span>
                    </div>
                </div>
            </div>
        </div>

        <div id="chatSection" class="chat-section tab-content">
            <div class="config-toggle collapsed">
                <h3>LLM Configuration</h3>
                <i class="fas fa-chevron-down"></i>
            </div>
            
            <div id="apiConfigPanel" class="config-panel collapsed">
                <div class="input-group">
                    <div class="parameter-group">
                        <label class="neo-label">Model Type</label>
                        <select id="modelType" class="neo-select">
                            <option value="openai">OpenAI Compatible</option>
                            <option value="gemini">Google Gemini</option>
                        </select>
                    </div>
                    <div id="openaiConfig">
                        <label class="neo-label">API Endpoint</label>
                        <input type="text" id="llmEndpoint" placeholder="Enter LLM API Endpoint URL" class="neo-input">
                        <label class="neo-label">Model Name</label>
                        <input type="text" id="modelName" placeholder="Model name (e.g. meta-llama/Llama-3.3-70B-Instruct)" class="neo-input">
                    </div>
                    <div id="geminiConfig" style="display: none;">
                        <label class="neo-label">Gemini Model</label>
                        <select id="geminiModel" class="neo-select">
                            <option value="gemini-2.0-flash">Gemini 2.0 Flash - Fast & Efficient</option>
                            <option value="gemini-2.0-flash-lite">Gemini 2.0 Flash Lite - Most Cost-Effective</option>
                            <option value="gemini-2.5-pro">Gemini 2.5 Pro - Most Advanced</option>
                        </select>
                    </div>
                    <label class="neo-label">API Key</label>
                    <input type="password" id="apiKey" placeholder="API Key" class="neo-input">
                    <div class="parameter-group">
                        <label class="neo-label">Temperature</label>
                        <input type="range" id="temperature" min="0" max="1" step="0.1" value="0.1" class="neo-range">
                        <span id="temperatureValue" class="neo-value">0.1</span>
                    </div>
                    <div class="parameter-group">
                        <label class="neo-label">Max Tokens</label>
                        <input type="number" id="maxTokens" value="512" min="1" max="2048" class="neo-input">
                    </div>
                    <div class="parameter-group">
                        <label class="neo-label">Top P</label>
                        <input type="range" id="topP" min="0" max="1" step="0.1" value="0.9" class="neo-range">
                        <span id="topPValue" class="neo-value">0.9</span>
                    </div>
                    <div class="parameter-group">
                        <label class="neo-label">System Prompt</label>
                        <textarea id="systemPrompt" class="neo-input" rows="6" placeholder="Enter custom system prompt for tweet analysis"></textarea>
                    </div>
                    <button id="saveConfig" class="neo-button">Save Configuration</button>
                </div>
                <div id="configStatus" class="status"></div>
            </div>

            <script>
                // Add model type change handler
                const modelType = document.getElementById('modelType');
                const openaiConfig = document.getElementById('openaiConfig');
                const geminiConfig = document.getElementById('geminiConfig');

                modelType.addEventListener('change', function() {
                    if (this.value === 'gemini') {
                        openaiConfig.style.display = 'none';
                        geminiConfig.style.display = 'block';
                    } else {
                        openaiConfig.style.display = 'block';
                        geminiConfig.style.display = 'none';
                    }
                });

                // Update save configuration handler
                saveConfig.addEventListener('click', async () => {
                    try {
                        const isGemini = modelType.value === 'gemini';
                        const config = {
                            type: modelType.value,
                            endpoint: isGemini ? 'https://generativelanguage.googleapis.com/v1beta' : llmEndpoint.value.trim(),
                            model: isGemini ? document.getElementById('geminiModel').value : modelName.value.trim(),
                            apiKey: apiKey.value.trim() || null,
                            temperature: parseFloat(temperature.value),
                            maxTokens: parseInt(maxTokens.value),
                            topP: parseFloat(topP.value),
                            systemPrompt: document.getElementById('systemPrompt').value.trim() || null
                        };
                        
                        if (!isGemini && !config.endpoint) {
                            throw new Error('Endpoint URL is required for OpenAI compatible models');
                        }
                        if (!isGemini && !config.model) {
                            throw new Error('Model name is required for OpenAI compatible models');
                        }
                        if (!config.apiKey) {
                            throw new Error('API Key is required');
                        }

                        // Validate URL format for OpenAI compatible endpoints
                        if (!isGemini) {
                            new URL(config.endpoint);
                        }
                        
                        await window.electronAPI.saveLLMConfig(config);
                        configStatus.textContent = 'Configuration saved successfully';
                        configStatus.className = 'status ready';
                    } catch (error) {
                        configStatus.textContent = `Configuration error: ${error.message}`;
                        configStatus.className = 'status not-ready';
                    }
                });

                // Load saved configuration
                async function loadLLMConfig() {
                    try {
                        const config = await window.electronAPI.getLLMConfig();
                        if (config) {
                            modelType.value = config.type || 'openai';
                            if (config.type === 'gemini') {
                                openaiConfig.style.display = 'none';
                                geminiConfig.style.display = 'block';
                                document.getElementById('geminiModel').value = config.model;
                            } else {
                                openaiConfig.style.display = 'block';
                                geminiConfig.style.display = 'none';
                                llmEndpoint.value = config.endpoint;
                                modelName.value = config.model;
                            }
                            apiKey.value = config.apiKey || '';
                            temperature.value = config.temperature;
                            temperatureValue.textContent = config.temperature;
                            maxTokens.value = config.maxTokens;
                            topP.value = config.topP;
                            topPValue.textContent = config.topP;
                            document.getElementById('systemPrompt').value = config.systemPrompt || '';
                            configStatus.textContent = 'Configuration loaded';
                            configStatus.className = 'status ready';
                        }
                    } catch (error) {
                        console.error('Error loading LLM config:', error);
                    }
                }
            </script>

            <div class="chat-container">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-container">
                    <textarea id="chatInput" class="chat-input" placeholder="Ask about your scraped tweets..."></textarea>
                    <button id="sendMessage" class="send-button">
                        <i class="fas fa-paper-plane"></i>
                        Send
                    </button>
                </div>
            </div>
        </div>

        <div id="querySection" class="card tab-content">
            <div class="config-panel">
                <h3>Natural Language Database Query</h3>
                <p class="description">Query your tweets using natural language. Examples:</p>
                <ul class="examples">
                    <li>"Show tweets with more than 1000 likes"</li>
                    <li>"Find tweets mentioning AI from last week"</li>
                    <li>"Get tweets by user @example with high engagement"</li>
                </ul>
                <div class="query-input-container">
                    <textarea id="naturalQueryInput" placeholder="Enter your query in natural language..." class="neo-input" rows="3"></textarea>
                    <button id="executeQuery" class="neo-button">Execute Query</button>
                </div>
            </div>
            <div id="queryResults" class="results-container">
                <div id="queryInfo" class="query-info"></div>
                <div id="queryData" class="query-data"></div>
            </div>
        </div>

        <!-- Add this new section for Settings after the other tab-content sections -->
        <div id="settingsSection" class="tab-content">
            <!-- API Delegation Settings -->
            <div class="neo-card">
                <h3 class="neo-title">API Delegation Settings</h3>
                <p class="neo-description">Enable API delegation to allow external applications to use this scraper via HTTP requests.</p>
                
                <div class="status-container">
                    <div class="status-indicator" id="delegationStatusIndicator"></div>
                    <div class="status-text">
                        <p>API Delegation: <span id="delegationStatus">Disabled</span></p>
                        <p>Port: <span id="delegationPort">3000</span></p>
                    </div>
                </div>
                
                <div class="input-group">
                    <button id="enableDelegationBtn" class="neo-button">Enable API Delegation</button>
                    <button id="disableDelegationBtn" class="neo-button danger" style="display: none;">Disable API Delegation</button>
                </div>
                
                <div class="info-box" id="delegationInfoBox" style="display: none;">
                    <h4>API Usage Example</h4>
                    <pre>
curl -X POST http://localhost:<span id="apiPortExample">3000</span>/api/scrape/tweets \
    -H "Content-Type: application/json" \
    -d '{"query": "tesla", "limit": 100}'
                    </pre>
                    <p>View complete API documentation at <a id="apiDocsLink" href="#">http://localhost:<span id="apiDocsPort">3000</span>/api/docs</a></p>
                    <p class="neo-description"><strong>Note:</strong> Maximum 500 tweets can be requested at once.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Initial load');
        
        // Debug check for the electronAPI object
        console.log('window.electronAPI available:', !!window.electronAPI);
        if (window.electronAPI) {
            console.log('Available methods:', Object.keys(window.electronAPI));
            console.log('getDelegationStatus available:', !!window.electronAPI.getDelegationStatus);
            console.log('enableDelegation available:', !!window.electronAPI.enableDelegation);
            console.log('disableDelegation available:', !!window.electronAPI.disableDelegation);
        }

        let currentStatus = 'not_ready';
        
        // UI Elements
        const statusDiv = document.getElementById('status');
        const authButton = document.getElementById('auth-button');
        const scrapeButton = document.getElementById('scrape-button');
        const scrapeProfileButton = document.getElementById('scrape-profile-button');
        const scrapeHomeButton = document.getElementById('scrape-home-button');
        const queryInput = document.getElementById('query');
        const limitInput = document.getElementById('limit');
        const usernameInput = document.getElementById('username');
        const profileLimitInput = document.getElementById('profileLimit');
        const homeLimitInput = document.getElementById('homeLimit');
        const resultsDiv = document.getElementById('results');
        const historyResultsDiv = document.getElementById('historyResults');
        const clearHistoryButton = document.getElementById('clearHistoryButton');
        const tabs = document.querySelectorAll('.tab');
        const scrapeSection = document.getElementById('scrapeSection');
        const historySection = document.getElementById('historySection');
        const logoutButton = document.getElementById('logout-button');

        // Auto-scraping UI elements
        const startAutoScrapeButton = document.getElementById('auto-scrape-button');
        const stopAutoScrapeButton = document.getElementById('stop-auto-scrape-button');
        const scrapeInterval = document.getElementById('scrapeInterval');
        const profileType = document.getElementById('profileType');
        const profileTarget = document.getElementById('profileTarget');
        const addProfileButton = document.getElementById('addProfileButton');
        const profilesList = document.getElementById('profilesList');

        // Chat functionality
        const chatInput = document.getElementById('chatInput');
        const sendMessage = document.getElementById('sendMessage');
        const chatMessages = document.getElementById('chatMessages');
        const llmEndpoint = document.getElementById('llmEndpoint');
        const apiKey = document.getElementById('apiKey');
        const saveConfig = document.getElementById('saveConfig');
        const configStatus = document.getElementById('configStatus');
        const modelName = document.getElementById('modelName');
        const temperature = document.getElementById('temperature');
        const temperatureValue = document.getElementById('temperatureValue');
        const maxTokens = document.getElementById('maxTokens');
        const topP = document.getElementById('topP');
        const topPValue = document.getElementById('topPValue');

        // Add these variables at the top with other variables
        let autoScrapeInterval = null;
        let isAutoScraping = false;
        let nextScrapeTime = null;
        let countdownInterval = null;
        let currentConversationId = Date.now().toString();
        let awaitingTimeframe = false;

        // Scraping status management
        let isScrapingInProgress = false;
        const scrapingStatus = document.getElementById('scrapingStatus');
        const scrapingStatusText = document.getElementById('scrapingStatusText');

        function showScrapingStatus(inProgress = true) {
            isScrapingInProgress = inProgress;
            scrapingStatus.className = `scraping-status active ${inProgress ? 'in-progress' : 'completed'}`;
            scrapingStatusText.textContent = inProgress ? 'Scraping in Progress...' : 'Scraping Completed';
            
            if (!inProgress) {
                // Hide the status after 3 seconds when scraping is completed
                setTimeout(() => {
                    scrapingStatus.classList.remove('active');
                }, 3000);
            }
        }

        // Tab switching
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                if (tab.dataset.tab === 'scrape') {
                    scrapeSection.classList.add('active');
                } else if (tab.dataset.tab === 'history') {
                    historySection.classList.add('active');
                    loadStoredTweets();
                } else if (tab.dataset.tab === 'auto-scrape') {
                    document.getElementById('autoScrapeSection').classList.add('active');
                    loadAutoScrapingProfiles();
                } else if (tab.dataset.tab === 'chat') {
                    document.getElementById('chatSection').classList.add('active');
                    loadLLMConfig();
                } else if (tab.dataset.tab === 'query') {
                    document.getElementById('querySection').classList.add('active');
                } else if (tab.dataset.tab === 'settings') {
                    document.getElementById('settingsSection').classList.add('active');
                }
            });
        });

        // Update status periodically
        async function updateStatus() {
            try {
                const status = await window.electronAPI.getStatus();
                const statusElement = document.getElementById('status');
                const authButton = document.getElementById('auth-button');
                const logoutButton = document.getElementById('logout-button');
                const scrapeButton = document.getElementById('scrape-button');
                const scrapeProfileButton = document.getElementById('scrape-profile-button');
                const scrapeHomeButton = document.getElementById('scrape-home-button');
                const autoScrapeButton = document.getElementById('auto-scrape-button');
                const profileControls = document.getElementById('profileInputSection');

                // Handle error states
                if (status.error) {
                    statusElement.textContent = status.error;
                    statusElement.className = 'status not-ready';
                    authButton.style.display = 'block';
                    logoutButton.style.display = 'none';
                    scrapeButton.disabled = true;
                    scrapeProfileButton.disabled = true;
                    scrapeHomeButton.disabled = true;
                    autoScrapeButton.disabled = true;
                    profileControls.style.display = 'none';
                    return;
                }

                // Update UI based on login state
                if (status.isLoggedIn) {
                    statusElement.textContent = 'Connected to Twitter';
                    statusElement.className = 'status ready';
                    authButton.style.display = 'none';
                    logoutButton.style.display = 'block';
                    
                    // Enable all scraping buttons
                    scrapeButton.disabled = false;
                    scrapeProfileButton.disabled = false;
                    scrapeHomeButton.disabled = false;
                    autoScrapeButton.disabled = false;
                    
                    // Only show profile controls if profile scraping is selected
                    const selectedScrapeType = document.querySelector('input[name="scrapeType"]:checked').value;
                    profileControls.style.display = selectedScrapeType === 'profile' ? 'block' : 'none';
                } else {
                    statusElement.textContent = 'Not connected to Twitter. Please authenticate.';
                    statusElement.className = 'status not-ready';
                    authButton.style.display = 'block';
                    logoutButton.style.display = 'none';
                    
                    // Disable all scraping buttons
                    scrapeButton.disabled = true;
                    scrapeProfileButton.disabled = true;
                    scrapeHomeButton.disabled = true;
                    autoScrapeButton.disabled = true;
                    profileControls.style.display = 'none';

                    // If auto-scraping is running, stop it
                    if (isAutoScraping) {
                        clearInterval(autoScrapeInterval);
                        isAutoScraping = false;
                        autoScrapeButton.textContent = 'Start Auto-Scraping';
                        document.getElementById('countdown').style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error updating status:', error);
                const statusElement = document.getElementById('status');
                statusElement.textContent = 'Error checking Twitter connection status';
                statusElement.className = 'status not-ready';
                
                // Disable all controls on error
                document.getElementById('auth-button').style.display = 'block';
                document.getElementById('logout-button').style.display = 'none';
                document.getElementById('scrape-button').disabled = true;
                document.getElementById('scrape-profile-button').disabled = true;
                document.getElementById('scrape-home-button').disabled = true;
                document.getElementById('auto-scrape-button').disabled = true;
                document.getElementById('profileInputSection').style.display = 'none';
            }
        }

        // Load stored tweets
        async function loadStoredTweets() {
            try {
                const historyResultsDiv = document.getElementById('historyResults');
                historyResultsDiv.innerHTML = ''; // Clear existing content
                
                console.log('Fetching stored tweets...');
                const data = await window.electronAPI.getStoredTweets();
                console.log('Received data:', data);
                
                if (!data || !data.sessionsByDate || Object.keys(data.sessionsByDate).length === 0) {
                    historyResultsDiv.innerHTML = '<p class="text-gray-500">No scraping history found</p>';
                    return;
                }

                // Get all sessions and sort by date (newest first)
                const allSessions = [];
                for (const [date, sessions] of Object.entries(data.sessionsByDate)) {
                    sessions.forEach(session => {
                        allSessions.push({ ...session, date });
                    });
                }
                
                // Sort sessions by date (newest first) and take only the 10 most recent
                const recentSessions = allSessions
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 10);

                // Group the 10 most recent sessions by date
                const recentSessionsByDate = {};
                recentSessions.forEach(session => {
                    if (!recentSessionsByDate[session.date]) {
                        recentSessionsByDate[session.date] = [];
                    }
                    recentSessionsByDate[session.date].push(session);
                });

                // Display the sessions
                for (const [date, sessions] of Object.entries(recentSessionsByDate)) {
                    const dateSection = document.createElement('div');
                    dateSection.className = 'date-section';
                    dateSection.innerHTML = `<h3 class="date-header">${date}</h3>`;
                    
                    for (const session of sessions) {
                        const sessionCard = document.createElement('div');
                        sessionCard.className = 'session-card';
                        sessionCard.innerHTML = `
                            <div class="session-header">
                                <div class="session-info">
                                    <h3>${`@${session.target}`}</h3>
                                    <p class="session-date">${new Date(session.started_at).toLocaleString()}</p>
                                </div>
                                <div class="session-actions">
                                    <button class="btn btn-primary download-btn" data-session-id="${session._id}">
                                        <i class="fas fa-download"></i> Download
                                    </button>
                                    <button class="btn btn-danger delete-btn" data-session-id="${session._id}">
                                        <i class="fas fa-trash"></i> Delete
                                    </button>
                                </div>
                            </div>
                            <div class="session-stats">
                                <span class="stat"><i class="fas fa-tweet"></i> ${session.tweets_found} tweets</span>
                                <span class="stat"><i class="fas fa-clock"></i> ${new Date(session.completed_at).toLocaleString()}</span>
                            </div>
                        `;

                        // Add click handler for download button
                        const downloadBtn = sessionCard.querySelector('.download-btn');
                        downloadBtn.addEventListener('click', async () => {
                            try {
                                downloadBtn.disabled = true;
                                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Downloading...';
                                
                                const result = await window.electronAPI.downloadTweetsBySession(session._id);
                                
                                if (result.success) {
                                    showNotification(`Successfully downloaded ${result.tweetCount} tweets`, 'success');
                                } else {
                                    showNotification('Failed to download tweets', 'error');
                                }
                            } catch (error) {
                                console.error('Error downloading session tweets:', error);
                                showNotification('Error downloading tweets: ' + error.message, 'error');
                            } finally {
                                downloadBtn.disabled = false;
                                downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download';
                            }
                        });

                        // Add click handler for delete button
                        const deleteBtn = sessionCard.querySelector('.delete-btn');
                        deleteBtn.addEventListener('click', async () => {
                            if (confirm('Are you sure you want to delete this session?')) {
                                try {
                                    deleteBtn.disabled = true;
                                    deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Deleting...';
                                    
                                    await window.electronAPI.deleteSession(session._id);
                                    sessionCard.remove();
                                    showNotification('Session deleted successfully', 'success');
                                } catch (error) {
                                    console.error('Error deleting session:', error);
                                    showNotification('Error deleting session: ' + error.message, 'error');
                                } finally {
                                    deleteBtn.disabled = false;
                                    deleteBtn.innerHTML = '<i class="fas fa-trash"></i> Delete';
                                }
                            }
                        });

                        dateSection.appendChild(sessionCard);
                    }
                    
                    historyResultsDiv.appendChild(dateSection);
                }
            } catch (error) {
                console.error('Error loading stored tweets:', error);
                const historyResultsDiv = document.getElementById('historyResults');
                historyResultsDiv.innerHTML = `
                    <div class="text-red-500">
                        Error loading stored tweets: ${error.message}
                    </div>
                `;
            }
        }

        // Event Listeners
        authButton.addEventListener('click', async () => {
            try {
                authButton.disabled = true;
                authButton.classList.add('loading');
                authButton.innerHTML = `
                    <span>Authenticating...</span>
                    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                `;
                statusDiv.textContent = 'Authenticating with Twitter...';
                statusDiv.className = 'status not-ready';
                
                await window.electronAPI.startTwitterAuth();
                await updateStatus();
            } catch (error) {
                console.error('Authentication failed:', error);
                
                // Display more user-friendly error messages
                let errorMessage = 'Twitter authentication failed. Please try again.';
                
                // Check for browser-related errors
                if (error.message && error.message.includes('Browser could not be launched')) {
                    errorMessage = 'Authentication failed: No compatible browser found. Please install Google Chrome, Microsoft Edge, or Brave Browser.';
                } else if (error.message && error.message.includes('Failed to start Twitter authentication')) {
                    errorMessage = error.message;
                }
                
                // Create an error notification
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-notification';
                errorDiv.innerHTML = `
                    <div class="error-title">Authentication Error</div>
                    <div class="error-message">${errorMessage}</div>
                    <button class="close-error">×</button>
                `;
                document.body.appendChild(errorDiv);
                
                // Add event listener to close button
                errorDiv.querySelector('.close-error').addEventListener('click', () => {
                    errorDiv.remove();
                });
                
                // Auto-remove error after 10 seconds
                setTimeout(() => {
                    if (document.body.contains(errorDiv)) {
                        errorDiv.remove();
                    }
                }, 10000);
                
                statusDiv.textContent = 'Twitter authentication failed. Please try again.';
                statusDiv.className = 'status not-ready';
                authButton.style.display = 'block';
                logoutButton.style.display = 'none';
            } finally {
                authButton.disabled = false;
                authButton.classList.remove('loading');
                authButton.innerHTML = '<span>Start Twitter Authentication</span>';
            }
        });

        scrapeButton.addEventListener('click', async () => {
            try {
                const query = queryInput.value.trim();
                const limit = parseInt(limitInput.value) || 10;
                
                if (!query) {
                    alert('Please enter a search query');
                    return;
                }

                scrapeButton.disabled = true;
                scrapeButton.textContent = 'Scraping...';
                showScrapingStatus(true);
                
                const result = await window.electronAPI.scrapeTweets({ query, limit });
                resultsDiv.innerHTML = `<pre>${JSON.stringify(result.tweets, null, 2)}</pre>`;
                showScrapingStatus(false);
            } catch (error) {
                console.error('Scraping failed:', error);
                resultsDiv.innerHTML = `<p style="color: red;">Scraping failed: ${error.message}</p>`;
                showScrapingStatus(false);
            } finally {
                scrapeButton.disabled = false;
                scrapeButton.textContent = 'Search Tweets';
            }
        });

        scrapeProfileButton.addEventListener('click', async () => {
            try {
                const username = usernameInput.value.trim();
                const limit = parseInt(profileLimitInput.value) || 10;
                
                if (!username) {
                    alert('Please enter a Twitter username');
                    return;
                }

                scrapeProfileButton.disabled = true;
                scrapeProfileButton.textContent = 'Scraping...';
                showScrapingStatus(true);
                
                const result = await window.electronAPI.scrapeProfile({ username, limit });
                resultsDiv.innerHTML = `<pre>${JSON.stringify(result.data, null, 2)}</pre>`;
                showScrapingStatus(false);
            } catch (error) {
                console.error('Profile scraping failed:', error);
                resultsDiv.innerHTML = `<p style="color: red;">Profile scraping failed: ${error.message}</p>`;
                showScrapingStatus(false);
            } finally {
                scrapeProfileButton.disabled = false;
                scrapeProfileButton.textContent = 'Scrape Profile';
            }
        });

        scrapeHomeButton.addEventListener('click', async () => {
            try {
                const limit = parseInt(homeLimitInput.value) || 10;

                scrapeHomeButton.disabled = true;
                scrapeHomeButton.textContent = 'Scraping...';
                showScrapingStatus(true);
                
                const result = await window.electronAPI.scrapeHome({ limit });
                resultsDiv.innerHTML = `<pre>${JSON.stringify(result.tweets, null, 2)}</pre>`;
                showScrapingStatus(false);
            } catch (error) {
                console.error('Home timeline scraping failed:', error);
                resultsDiv.innerHTML = `<p style="color: red;">Home timeline scraping failed: ${error.message}</p>`;
                showScrapingStatus(false);
            } finally {
                scrapeHomeButton.disabled = false;
                scrapeHomeButton.textContent = 'Scrape Home';
            }
        });

        clearHistoryButton.addEventListener('click', async () => {
            if (confirm('Are you sure you want to clear all stored tweets?')) {
                try {
                    await window.electronAPI.clearStoredTweets();
                    await loadStoredTweets();
                } catch (error) {
                    console.error('Failed to clear history:', error);
                    alert('Failed to clear history: ' + error.message);
                }
            }
        });

        logoutButton.addEventListener('click', async () => {
            try {
                statusDiv.textContent = 'Logging out...';
                const result = await window.electronAPI.clearTwitterSession();
                if (result.success) {
                    statusDiv.textContent = 'Logged out from Twitter. Please login again to continue.';
                    statusDiv.className = 'status not-ready';
                    authButton.style.display = 'block';
                    logoutButton.style.display = 'none';
                    
                    // Disable all scraping buttons
                    scrapeButton.disabled = true;
                    scrapeProfileButton.disabled = true;
                    scrapeHomeButton.disabled = true;
                    startAutoScrapeButton.disabled = true;
                    
                    // Stop auto-scraping if running
                    if (autoScrapeInterval !== null) {
                        clearInterval(autoScrapeInterval);
                        autoScrapeInterval = null;
                    }
                    
                    // Update status immediately
                    await updateStatus();
                } else {
                    statusDiv.textContent = 'Failed to logout. Please try again.';
                }
            } catch (error) {
                console.error('Error clearing session:', error);
                statusDiv.textContent = 'Error logging out from Twitter. Please try again.';
            }
        });

        // Load auto-scraping profiles
        async function loadAutoScrapingProfiles() {
            try {
                const response = await window.electronAPI.getAutoScrapingProfiles();
                profilesList.innerHTML = '';
                
                if (!response.profiles || response.profiles.length === 0) {
                    profilesList.innerHTML = '<p class="neo-description">No profiles added yet. Add profiles to start auto-scraping.</p>';
                    return;
                }
                
                for (const profile of response.profiles) {
                    const profileDiv = document.createElement('div');
                    profileDiv.className = 'profile-item';
                    profileDiv.innerHTML = `
                        <div class="profile-info">
                            <div class="profile-username">${profile.type === 'profile' ? '@' + profile.target : 'Home Timeline'}</div>
                            <div class="profile-timestamp">Last scraped: ${profile.last_scraped_at ? new Date(profile.last_scraped_at).toLocaleString() : 'Never'}</div>
                        </div>
                        <button class="remove-profile" data-type="${profile.type}" data-target="${profile.target}">Remove</button>
                    `;
                    profilesList.appendChild(profileDiv);
                }
            } catch (error) {
                console.error('Error loading auto-scraping profiles:', error);
                profilesList.innerHTML = `<div class="neo-error">Error loading profiles: ${error.message}</div>`;
            }
        }

        // Update the add profile button event listener
        addProfileButton.addEventListener('click', async () => {
            try {
                const scrapeType = document.querySelector('input[name="scrapeType"]:checked').value;
                const target = profileTarget.value.trim();
                
                if (scrapeType === 'profile' && !target) {
                    alert('Please enter a username for profile scraping');
                    return;
                }

                // Add the profile
                await window.electronAPI.addAutoScrapingProfile({ type: scrapeType, target });
                
                // Clear the input
                profileTarget.value = '';
                
                // Reload the profiles list
                await loadAutoScrapingProfiles();
                
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'neo-description';
                successMessage.textContent = `Successfully added ${scrapeType === 'profile' ? '@' + target : 'Home Timeline'}`;
                profilesList.insertBefore(successMessage, profilesList.firstChild);
                
                // Remove success message after 3 seconds
                setTimeout(() => {
                    successMessage.remove();
                }, 3000);
            } catch (error) {
                console.error('Error adding profile:', error);
                const errorMessage = document.createElement('div');
                errorMessage.className = 'neo-error';
                errorMessage.textContent = `Error adding profile: ${error.message}`;
                profilesList.insertBefore(errorMessage, profilesList.firstChild);
                
                // Remove error message after 3 seconds
                setTimeout(() => {
                    errorMessage.remove();
                }, 3000);
            }
        });

        // Update the remove profile event listener
        profilesList.addEventListener('click', async (event) => {
            if (event.target.classList.contains('remove-profile')) {
                try {
                    const type = event.target.dataset.type;
                    const target = event.target.dataset.target;
                    
                    await window.electronAPI.removeAutoScrapingProfile({ type, target });
                    await loadAutoScrapingProfiles();
                    
                    // Show success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'neo-description';
                    successMessage.textContent = `Successfully removed ${type === 'profile' ? '@' + target : 'Home Timeline'}`;
                    profilesList.insertBefore(successMessage, profilesList.firstChild);
                    
                    // Remove success message after 3 seconds
                    setTimeout(() => {
                        successMessage.remove();
                    }, 3000);
                } catch (error) {
                    console.error('Error removing profile:', error);
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'neo-error';
                    errorMessage.textContent = `Error removing profile: ${error.message}`;
                    profilesList.insertBefore(errorMessage, profilesList.firstChild);
                    
                    // Remove error message after 3 seconds
                    setTimeout(() => {
                        errorMessage.remove();
                    }, 3000);
                }
            }
        });

        // Update the radio button event listeners
        document.querySelectorAll('input[name="scrapeType"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const profileInputSection = document.getElementById('profileInputSection');
                const profileTarget = document.getElementById('profileTarget');
                
                if (e.target.value === 'home') {
                    profileInputSection.style.display = 'none';
                    if (profileTarget) {
                        profileTarget.value = '';
                    }
                } else {
                    profileInputSection.style.display = 'block';
                }
            });
        });

        // Update the countdown timer function
        function startCountdownTimer(interval) {
            const countdownTimer = document.getElementById('countdownTimer');
            nextScrapeTime = Date.now() + interval;
            
            // Clear existing interval if any
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            
            function updateTimer() {
                const now = Date.now();
                const timeLeft = nextScrapeTime - now;
                
                if (timeLeft <= 0) {
                    nextScrapeTime = now + interval;
                }
                
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                countdownTimer.textContent = `${minutes}m ${seconds}s`;
            }
            
            // Update immediately and then start interval
            updateTimer();
            countdownInterval = setInterval(updateTimer, 1000);
        }

        // Update the start auto-scraping function
        startAutoScrapeButton.addEventListener('click', async () => {
            try {
                const interval = parseInt(scrapeInterval.value);
                const scrapeType = document.querySelector('input[name="scrapeType"]:checked').value;
                
                if (scrapeType === 'profile') {
                    const profiles = document.querySelectorAll('#profilesList .profile-item');
                    if (profiles.length === 0) {
                        alert('Please add at least one profile for auto-scraping');
                        return;
                    }
                }

                await window.electronAPI.startAutoScraping({ interval, type: scrapeType });
                startAutoScrapeButton.style.display = 'none';
                stopAutoScrapeButton.style.display = 'block';
                
                // Start countdown timer
                startCountdownTimer(interval);
                
                // Show scraping info
                const nextScrapeInfo = document.getElementById('nextScrapeInfo');
                const scrapingTypeDisplay = document.getElementById('scrapingTypeDisplay');
                nextScrapeInfo.style.display = 'block';
                scrapingTypeDisplay.textContent = scrapeType === 'home' ? 'Home Timeline' : 'Selected Profiles';
                
                // Disable scrape type selection and interval change
                document.querySelectorAll('input[name="scrapeType"]').forEach(radio => radio.disabled = true);
                scrapeInterval.disabled = true;

                isAutoScraping = true;
            } catch (error) {
                console.error('Error starting auto-scraping:', error);
                alert(error.message);
            }
        });

        // Add the recursive scraping cycle function
        async function startScrapingCycle(interval, scrapeType) {
            if (!isAutoScraping) return;

            try {
                // Wait for the interval duration
                await new Promise(resolve => setTimeout(resolve, interval));
                
                if (!isAutoScraping) return; // Check if still auto-scraping after wait

                // Refresh page and perform scraping
                await performScraping(scrapeType);
                
                // Update status and reset countdown
                await updateStatus();
                startCountdownTimer(interval);
                
                // Start next cycle
                await startScrapingCycle(interval, scrapeType);
            } catch (error) {
                console.error('Error in scraping cycle:', error);
                if (isAutoScraping) {
                    // If still auto-scraping, try to continue with next cycle
                    await startScrapingCycle(interval, scrapeType);
                }
            }
        }

        // Update the performScraping function
        async function performScraping(scrapeType) {
            try {
                showScrapingStatus(true);
                // First refresh the home page
                await window.electronAPI.scrapeHome({ limit: 1 });
                await new Promise(resolve => setTimeout(resolve, 2000)); // Wait for page to settle

                if (scrapeType === 'home') {
                    // Scrape home timeline
                    const result = await window.electronAPI.scrapeHome({ limit: 50 });
                    if (result && result.data) {
                        // Save home timeline data
                        await window.electronAPI.saveTweets({
                            type: 'home',
                            tweets: result.data.tweets,
                            timestamp: new Date().toISOString()
                        });
                    }
                    console.log('Auto-scraped home timeline:', result);
                } else {
                    // Get all profiles and scrape each one
                    const profiles = document.querySelectorAll('#profilesList .profile-item');
                    for (const profile of profiles) {
                        if (!isAutoScraping) return; // Check if still auto-scraping
                        
                        const username = profile.querySelector('.font-medium').textContent.replace('@', '');
                        const result = await window.electronAPI.scrapeProfile({ username, limit: 50 });
                        if (result && result.data) {
                            // Save profile data
                            await window.electronAPI.saveTweets({
                                type: 'profile',
                                username,
                                tweets: result.data.tweets,
                                profileInfo: result.data.profile,
                                timestamp: new Date().toISOString()
                            });
                        }
                        console.log(`Auto-scraped profile ${username}:`, result);
                    }
                }
                showScrapingStatus(false);
            } catch (error) {
                console.error('Error during scraping:', error);
                showScrapingStatus(false);
                throw error;
            }
        }

        // Update the stop auto-scraping function
        stopAutoScrapeButton.addEventListener('click', async () => {
            try {
                await window.electronAPI.stopAutoScraping();
                
                startAutoScrapeButton.style.display = 'block';
                stopAutoScrapeButton.style.display = 'none';
                
                // Stop and hide countdown timer
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                    countdownInterval = null;
                }
                document.getElementById('nextScrapeInfo').style.display = 'none';
                
                // Enable scrape type selection and interval change
                document.querySelectorAll('input[name="scrapeType"]').forEach(radio => radio.disabled = false);
                scrapeInterval.disabled = false;

                isAutoScraping = false;
            } catch (error) {
                console.error('Error stopping auto-scraping:', error);
                alert(error.message);
            }
        });

        // Update the profile list UI
        function updateProfilesList(profile) {
            const profileDiv = document.createElement('div');
            profileDiv.className = 'profile-item flex items-center justify-between p-2 bg-white rounded border';
            profileDiv.innerHTML = `
                <div class="font-medium">@${profile.target}</div>
                <button class="remove-profile-button text-red-600 hover:text-red-800" data-target="${profile.target}">
                    Remove
                </button>
            `;
            profilesList.appendChild(profileDiv);
        }

        // Load saved configuration
        async function loadLLMConfig() {
            try {
                const config = await window.electronAPI.getLLMConfig();
                if (config) {
                    modelType.value = config.type || 'openai';
                    if (config.type === 'gemini') {
                        openaiConfig.style.display = 'none';
                        geminiConfig.style.display = 'block';
                        document.getElementById('geminiModel').value = config.model;
                    } else {
                        openaiConfig.style.display = 'block';
                        geminiConfig.style.display = 'none';
                        llmEndpoint.value = config.endpoint;
                        modelName.value = config.model;
                    }
                    apiKey.value = config.apiKey || '';
                    temperature.value = config.temperature;
                    temperatureValue.textContent = config.temperature;
                    maxTokens.value = config.maxTokens;
                    topP.value = config.topP;
                    topPValue.textContent = config.topP;
                    document.getElementById('systemPrompt').value = config.systemPrompt || '';
                    configStatus.textContent = 'Configuration loaded';
                    configStatus.className = 'status ready';
                }
            } catch (error) {
                console.error('Error loading LLM config:', error);
            }
        }

        // Update the parseAndFormatResponse function
        function parseAndFormatResponse(response) {
            // First, check if it's a Twitter accounts analysis
            if (response.includes('Based on the provided tweets, the following Twitter accounts')) {
                return formatTwitterAccountsAnalysis(response);
            }

            // Check if the response has numbered points
            const numberedPoints = response.match(/\d+\.\s+\*\*[^*]+\*\*[^]*?(?=\d+\.|$)/g);
            if (numberedPoints) {
                let formattedHtml = '<div class="insights-container">';
                
                numberedPoints.forEach((point, index) => {
                    // Extract title and content
                    const titleMatch = point.match(/\*\*(.+?)\*\*/);
                    if (titleMatch) {
                        const title = titleMatch[1];
                        const content = point.replace(/\d+\.\s+\*\*(.+?)\*\*:\s*/, '').trim();
                        
                        formattedHtml += `
                            <div class="insight-point" data-number="${index + 1}">
                                <div class="insight-title">${title}</div>
                                <div class="insight-content">${formatContent(content)}</div>
                            </div>
                        `;
                    }
                });
                
                formattedHtml += '</div>';
                return formattedHtml;
            }
            
            // If no special format, wrap in a simple message container
            return `<div class="insight-content">${formatContent(response)}</div>`;
        }

        function formatTwitterAccountsAnalysis(response) {
            const sections = response.split(/(?=Based on the provided tweets|Additionally,)/g);
            let formattedHtml = '<div class="insights-container">';

            sections.forEach((section, index) => {
                if (!section.trim()) return;

                // Extract accounts and their descriptions
                const accounts = section.match(/@\w+\s*-[^.]+\./g) || [];
                
                if (accounts.length > 0) {
                    formattedHtml += `
                        <div class="insight-point">
                            <div class="insight-title">${index === 0 ? 'Twitter Accounts Mentioning RWA' : 'Additional Mentions'}</div>
                            <div class="accounts-list">
                                ${accounts.map(account => {
                                    const [handle, description] = account.split('-').map(s => s.trim());
                                    return `
                                        <div class="account-item">
                                            <div class="account-handle">${handle}</div>
                                            <div class="account-description">${description.replace('.', '')}</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }

                // Add any remaining context
                const context = section.replace(/@\w+\s*-[^.]+\./g, '').trim();
                if (context && !context.startsWith('Based') && !context.startsWith('Additionally')) {
                    formattedHtml += `
                        <div class="insight-point">
                            <div class="insight-content">${formatContent(context)}</div>
                        </div>
                    `;
                }
            });

            formattedHtml += '</div>';
            return formattedHtml;
        }

        function formatContent(content) {
            // Highlight Twitter handles
            content = content.replace(/@[\w]+/g, match => 
                `<span class="highlight-account">${match}</span>`
            );
            
            // Highlight key terms
            return content.replace(/([A-Z][a-zA-Z-]+(?:\s+[A-Z][a-zA-Z-]+)*)/g, 
                match => match.startsWith('@') ? match : `<span class="highlight">${match}</span>`
            );
        }

        // Update the addMessage function
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            if (isUser) {
                messageDiv.textContent = content;
            } else {
                messageDiv.innerHTML = parseAndFormatResponse(content);
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Add new function to create progress steps
        function createProgressSteps() {
            const stepsDiv = document.createElement('div');
            stepsDiv.className = 'progress-steps';
            stepsDiv.innerHTML = `
                <div class="step" data-step="retrieve">
                    <div class="step-icon">1</div>
                    <div class="step-content">
                        <div class="step-title">Retrieving Tweets</div>
                        <div class="step-details">Fetching relevant tweets from the database</div>
                        <div class="step-timing"></div>
                    </div>
                    <div class="step-loader">
                        <div class="loader-spinner"></div>
                        <div style="display: flex;">
                            <div class="loader-pulse" style="--delay: 0"></div>
                            <div class="loader-pulse" style="--delay: 1"></div>
                            <div class="loader-pulse" style="--delay: 2"></div>
                        </div>
                    </div>
                </div>
                <div class="step" data-step="analyze">
                    <div class="step-icon">2</div>
                    <div class="step-content">
                        <div class="step-title">Analyzing Content</div>
                        <div class="step-details">Processing tweets through LLM for analysis</div>
                        <div class="step-timing"></div>
                    </div>
                    <div class="step-loader">
                        <div class="loader-spinner"></div>
                        <div style="display: flex;">
                            <div class="loader-pulse" style="--delay: 0"></div>
                            <div class="loader-pulse" style="--delay: 1"></div>
                            <div class="loader-pulse" style="--delay: 2"></div>
                        </div>
                    </div>
                </div>
                <div class="step" data-step="format">
                    <div class="step-icon">3</div>
                    <div class="step-content">
                        <div class="step-title">Formatting Response</div>
                        <div class="step-details">Preparing the final analysis</div>
                        <div class="step-timing"></div>
                    </div>
                    <div class="step-loader">
                        <div class="loader-spinner"></div>
                        <div style="display: flex;">
                            <div class="loader-pulse" style="--delay: 0"></div>
                            <div class="loader-pulse" style="--delay: 1"></div>
                            <div class="loader-pulse" style="--delay: 2"></div>
                        </div>
                    </div>
                </div>
            `;
            return stepsDiv;
        }

        // Update the function that marks a step as completed
        function completeStep(step) {
            step.classList.remove('active');
            step.classList.add('completed');
            const loader = step.querySelector('.step-loader');
            loader.innerHTML = '<div class="completion-check">✓</div>';
        }

        // Update the sendMessage event listener
        sendMessage.addEventListener('click', async () => {
            const message = chatInput.value.trim();
            if (!message) return;

            try {
                addMessage(message, true);
                chatInput.value = '';
                chatInput.disabled = true;
                sendMessage.disabled = true;

                // Add progress steps
                const progressSteps = createProgressSteps();
                chatMessages.appendChild(progressSteps);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // Start timing
                const startTime = Date.now();

                // Step 1: Retrieve tweets
                const retrieveStep = progressSteps.querySelector('[data-step="retrieve"]');
                retrieveStep.classList.add('active');
                const retrieveStartTime = Date.now();
                
                const response = await window.electronAPI.chatQuery({
                    query: message,
                    conversationId: currentConversationId,
                    timeframe: awaitingTimeframe ? message : null
                });

                // Update retrieve step timing and mark as completed
                const retrieveTime = Date.now() - retrieveStartTime;
                retrieveStep.querySelector('.step-timing').textContent = `Completed in ${retrieveTime}ms`;
                completeStep(retrieveStep);

                // Step 2: Analyze content
                const analyzeStep = progressSteps.querySelector('[data-step="analyze"]');
                analyzeStep.classList.add('active');
                const analyzeStartTime = Date.now();

                if (response.needsMoreInfo) {
                    awaitingTimeframe = true;
                    addMessage(response.prompt, false);
                } else {
                    awaitingTimeframe = false;
                    if (response.queryDetails) {
                        addQueryDetails(response.queryDetails, response.tweetCount);
                    }
                    addMessage(response.response, false);
                }

                // Update analyze step timing and mark as completed
                const analyzeTime = Date.now() - analyzeStartTime;
                analyzeStep.querySelector('.step-timing').textContent = `Completed in ${analyzeTime}ms`;
                completeStep(analyzeStep);

                // Step 3: Format response
                const formatStep = progressSteps.querySelector('[data-step="format"]');
                formatStep.classList.add('active');
                const formatStartTime = Date.now();

                // Simulate a small delay for formatting
                await new Promise(resolve => setTimeout(resolve, 500));

                // Update format step timing and mark as completed
                const formatTime = Date.now() - formatStartTime;
                formatStep.querySelector('.step-timing').textContent = `Completed in ${formatTime}ms`;
                completeStep(formatStep);

                // Add total time
                const totalTime = Date.now() - startTime;
                const totalTimeDiv = document.createElement('div');
                totalTimeDiv.className = 'step-timing';
                totalTimeDiv.style.textAlign = 'right';
                totalTimeDiv.style.marginTop = '10px';
                totalTimeDiv.textContent = `Total processing time: ${totalTime}ms`;
                progressSteps.appendChild(totalTimeDiv);

            } catch (error) {
                // Mark all active steps as failed
                progressSteps.querySelectorAll('.step.active').forEach(step => {
                    step.classList.remove('active');
                    step.classList.add('failed');
                    const loader = step.querySelector('.step-loader');
                    loader.innerHTML = '<div class="completion-check" style="background: #ff4444;">✕</div>';
                });

                addMessage(`Error: ${error.message}`, false);
                // Start a new conversation on error
                currentConversationId = Date.now().toString();
                awaitingTimeframe = false;
            } finally {
                chatInput.disabled = false;
                sendMessage.disabled = false;
            }
        });

        function addQueryDetails(queryDetails, tweetCount) {
            const queryDiv = document.createElement('div');
            queryDiv.className = 'message query-details';
            queryDiv.innerHTML = `
                <div class="query-info">
                    <strong>Query Details:</strong>
                    <pre>${JSON.stringify(queryDetails, null, 2)}</pre>
                    <div class="tweet-count">Found ${tweetCount} tweets</div>
                </div>
            `;
            chatMessages.appendChild(queryDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Update range value displays
        temperature.addEventListener('input', (e) => {
            temperatureValue.textContent = e.target.value;
        });

        topP.addEventListener('input', (e) => {
            topPValue.textContent = e.target.value;
        });

        // Natural query handling
        const naturalQueryInput = document.getElementById('naturalQueryInput');
        const executeQuery = document.getElementById('executeQuery');
        const queryInfo = document.getElementById('queryInfo');
        const queryData = document.getElementById('queryData');

        executeQuery.addEventListener('click', async () => {
            const query = naturalQueryInput.value.trim();
            if (!query) return;

            try {
                executeQuery.disabled = true;
                queryInfo.textContent = 'Executing query...';
                queryData.innerHTML = '';

                const response = await window.electronAPI.naturalQuery(query);
                
                // Display the MongoDB query
                queryInfo.innerHTML = `<strong>MongoDB Query:</strong><br>${JSON.stringify(response.query, null, 2)}`;

                // Display results
                if (response.results.length === 0) {
                    queryData.innerHTML = '<div class="no-results">No tweets found matching your query.</div>';
                } else {
                    queryData.innerHTML = response.results.map(tweet => `
                        <div class="tweet-result">
                            <div class="tweet-header">
                                <span>${tweet.user_name} (@${tweet.user_handle})</span>
                                <span>${new Date(tweet.timestamp).toLocaleString()}</span>
                            </div>
                            <div class="tweet-content">${tweet.content}</div>
                            <div class="tweet-metrics">
                                <span>💬 ${tweet.metrics.replies}</span>
                                <span>🔄 ${tweet.metrics.retweets}</span>
                                <span>❤️ ${tweet.metrics.likes}</span>
                                <span>👁️ ${tweet.metrics.views}</span>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                queryInfo.innerHTML = `<strong>Error:</strong><br>${error.message}`;
                queryData.innerHTML = '';
            } finally {
                executeQuery.disabled = false;
            }
        });

        // Initial status check
        updateStatus();
        setInterval(updateStatus, 5000);

        // Add notification function
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add notification styles
        const style = document.createElement('style');
        style.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 24px;
                border-radius: 4px;
                background-color: #fff;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                display: flex;
                align-items: center;
                gap: 12px;
                z-index: 1000;
                animation: slide-in 0.3s ease-out;
            }

            .notification.success {
                border-left: 4px solid #4CAF50;
            }

            .notification.error {
                border-left: 4px solid #f44336;
            }

            .notification i {
                font-size: 20px;
            }

            .notification.success i {
                color: #4CAF50;
            }

            .notification.error i {
                color: #f44336;
            }

            .notification.fade-out {
                animation: slide-out 0.3s ease-in forwards;
            }

            @keyframes slide-in {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slide-out {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Add this to your JavaScript section
        document.querySelector('.config-toggle').addEventListener('click', function() {
            const configPanel = document.getElementById('apiConfigPanel');
            this.classList.toggle('collapsed');
            configPanel.classList.toggle('collapsed');
        });

        // Remove data sharing toggle handler
        // const shareDataToggle = document.getElementById('shareData');
        // shareDataToggle.addEventListener('change', async (e) => {
        //     try {
        //         const response = await window.electronAPI.setDataSharing(e.target.checked);
        //         if (response.success) {
        //             showStatus('Data sharing preference updated', 'success');
        //         } else {
        //             showStatus('Failed to update data sharing preference', 'error');
        //         }
        //     } catch (error) {
        //         console.error('Error updating data sharing preference:', error);
        //         showStatus('Error updating data sharing preference', 'error');
        //     }
        // });

        // Remove initial data sharing preference loading
        // window.electronAPI.getDataSharing().then(preference => {
        //     shareDataToggle.checked = preference;
        // });

        document.querySelectorAll('.delete-btn').forEach(button => {
            button.addEventListener('click', async (e) => {
                const sessionId = e.currentTarget.dataset.sessionId;
                const button = e.currentTarget;
                
                if (confirm('Are you sure you want to delete this session? This action cannot be undone.')) {
                    button.disabled = true;
                    button.innerHTML = '<div class="spinner"></div> Deleting...';
                    
                    try {
                        await window.electronAPI.deleteSession(sessionId);
                        const sessionCard = document.querySelector(`.session-card[data-session-id="${sessionId}"]`);
                        if (sessionCard) {
                            sessionCard.remove();
                        }
                        showNotification('Session deleted successfully', 'success');
                    } catch (error) {
                        console.error('Error deleting session:', error);
                        showNotification('Error deleting session', 'error');
                        button.disabled = false;
                        button.innerHTML = '<i class="fas fa-trash"></i> Delete';
                    }
                }
            });
        });

        // Add event listeners for auto-scraping status updates
        if (window.electronAPI.onAutoScrapingStatus) {
            window.electronAPI.onAutoScrapingStatus((status) => {
                const statusElement = document.getElementById('autoScrapingStatus');
                if (statusElement) {
                    if (status.isActive) {
                        statusElement.textContent = `Auto-scraping active (${status.interval / 60000} min interval)`;
                        statusElement.className = 'status active';
                    } else {
                        statusElement.textContent = 'Auto-scraping inactive';
                        statusElement.className = 'status inactive';
                    }
                }
            });
        }

        // Add event listeners for auto-scraping events
        if (window.electronAPI.onAutoScrapingEvent) {
            window.electronAPI.onAutoScrapingEvent((event) => {
                const eventLog = document.getElementById('autoScrapingEventLog');
                if (eventLog) {
                    const eventElement = document.createElement('div');
                    eventElement.className = 'event-log-entry';
                    
                    switch (event.type) {
                        case 'cycleStarted':
                            eventElement.textContent = 'Starting new scraping cycle...';
                            break;
                        case 'cycleCompleted':
                            eventElement.textContent = 'Scraping cycle completed';
                            break;
                        case 'cycleError':
                            eventElement.textContent = `Error in scraping cycle: ${event.error}`;
                            eventElement.className += ' error';
                            break;
                        case 'profileStarted':
                            eventElement.textContent = `Starting to scrape ${event.type}: ${event.target}`;
                            break;
                        case 'profileCompleted':
                            eventElement.textContent = `Completed scraping ${event.type}: ${event.target} (${event.tweetCount} tweets)`;
                            break;
                        case 'profileError':
                            eventElement.textContent = `Error scraping ${event.type}: ${event.target} - ${event.error}`;
                            eventElement.className += ' error';
                            break;
                        case 'profileAdded':
                            eventElement.textContent = `Added new auto-scraping profile: ${event.type}: ${event.target}`;
                            break;
                        case 'profileRemoved':
                            eventElement.textContent = `Removed auto-scraping profile: ${event.type}: ${event.target}`;
                            break;
                    }
                    
                    eventLog.insertBefore(eventElement, eventLog.firstChild);
                    
                    // Keep only the last 50 events
                    while (eventLog.children.length > 50) {
                        eventLog.removeChild(eventLog.lastChild);
                    }
                }
            });
        }

        // Clean up event listeners when window is closed
        window.addEventListener('beforeunload', () => {
            if (window.electronAPI.removeAutoScrapingStatusListener) {
                window.electronAPI.removeAutoScrapingStatusListener();
            }
            if (window.electronAPI.removeAutoScrapingEventListener) {
                window.electronAPI.removeAutoScrapingEventListener();
            }
        });

        // Add near the beginning of your script, perhaps right after variable declarations
        // Show license notification
        function showLicenseNotification() {
            const licenseDiv = document.createElement('div');
            licenseDiv.className = 'license-notification';
            licenseDiv.innerHTML = `
                <div class="license-title">License Information</div>
                <div class="license-content">
                    <p>This software is provided under a custom license that allows:</p>
                    <ul>
                        <li>Free personal use</li>
                        <li>Required login for all usage</li>
                        <li>Commercial use only with explicit permission</li>
                    </ul>
                    <p>By continuing to use this software, you agree to these terms.</p>
                </div>
                <button id="acceptLicense" class="accept-license">I Accept</button>
            `;
            document.body.appendChild(licenseDiv);
            
            document.getElementById('acceptLicense').addEventListener('click', () => {
                licenseDiv.remove();
                // Store acceptance in localStorage
                localStorage.setItem('licenseAccepted', 'true');
            });
        }

        // On page load
        document.addEventListener('DOMContentLoaded', async () => {
            // ... existing code that executes on DOM loaded ...
            
            // Show license notification if not previously accepted
            if (!localStorage.getItem('licenseAccepted')) {
                showLicenseNotification();
            }
            
            // ... rest of your existing initialization code ...
            
            // Load delegation status
            loadDelegationStatus();
        });

        // API Delegation Controls
        const delegationStatusIndicator = document.getElementById('delegationStatusIndicator');
        const delegationStatus = document.getElementById('delegationStatus');
        const delegationPort = document.getElementById('delegationPort');
        const enableDelegationBtn = document.getElementById('enableDelegationBtn');
        const disableDelegationBtn = document.getElementById('disableDelegationBtn');
        const delegationInfoBox = document.getElementById('delegationInfoBox');
        const apiPortExample = document.getElementById('apiPortExample');
        const apiDocsPort = document.getElementById('apiDocsPort');
        const apiDocsLink = document.getElementById('apiDocsLink');
        
        // Load delegation status on startup
        async function loadDelegationStatus() {
            try {
                console.log('Loading delegation status...');
                const status = await window.electronAPI.getDelegationStatus();
                console.log('Delegation status loaded:', status);
                updateDelegationUI(status);
            } catch (error) {
                console.error('Failed to load delegation status:', error);
            }
        }
        
        // Update UI based on delegation status
        function updateDelegationUI(status) {
            console.log('Updating delegation UI with status:', status);
            if (status.enabled) {
                delegationStatusIndicator.classList.add('enabled');
                delegationStatus.textContent = 'Enabled';
                enableDelegationBtn.style.display = 'none';
                disableDelegationBtn.style.display = 'inline-block';
                delegationInfoBox.style.display = 'block';
            } else {
                delegationStatusIndicator.classList.remove('enabled');
                delegationStatus.textContent = 'Disabled';
                enableDelegationBtn.style.display = 'inline-block';
                disableDelegationBtn.style.display = 'none';
                delegationInfoBox.style.display = 'none';
            }
            
            // Update port information
            delegationPort.textContent = status.port;
            apiPortExample.textContent = status.port;
            apiDocsPort.textContent = status.port;
            apiDocsLink.href = `http://localhost:${status.port}/api/docs`;
        }
        
        // Enable delegation
        enableDelegationBtn.addEventListener('click', async () => {
            try {
                console.log('Enable delegation button clicked');
                const status = await window.electronAPI.enableDelegation();
                console.log('Delegation enabled result:', status);
                updateDelegationUI(status);
                
                // Show success message
                showNotification('API Delegation Enabled', 'success');
            } catch (error) {
                console.error('Failed to enable delegation:', error);
                showNotification('Failed to enable API delegation', 'error');
            }
        });
        
        // Disable delegation
        disableDelegationBtn.addEventListener('click', async () => {
            try {
                const status = await window.electronAPI.disableDelegation();
                updateDelegationUI(status);
                
                // Show success message
                showNotification('API Delegation Disabled', 'success');
            } catch (error) {
                console.error('Failed to disable delegation:', error);
                showNotification('Failed to disable API delegation', 'error');
            }
        });
        
        // Open API docs in browser
        apiDocsLink.addEventListener('click', (event) => {
            event.preventDefault();
            window.open(apiDocsLink.href, '_blank');
        });
        
        // Load delegation status on page load
        document.addEventListener('DOMContentLoaded', () => {
            // ... existing code ...
            loadDelegationStatus();
        });
    </script>
</body>
</html> 